<div id="ShokoConfigPage" data-role="page" class="page type-interior pluginConfigurationPage" data-require="emby-input,emby-button,emby-select,emby-checkbox" data-controller="__plugin/ShokoController.js">
    <div data-role="content">
        <div class="content-primary">
            <form id="ShokoConfigForm">
                <div class="verticalSection verticalSection-extrabottompadding">
                    <div class="sectionTitleContainer flex align-items-center">
                        <h2 class="sectionTitle">Shoko</h2>
                        <a is="emby-linkbutton" rel="noopener noreferrer" class="raised button-alt headerHelpButton emby-button" target="_blank" href="https://docs.shokoanime.com/shokofin/configuration/">Help</a>
                    </div>
                    <fieldset id="ConnectionSection" class="verticalSection verticalSection-extrabottompadding" hidden>
                        <legend>
                            <h3>Connection Settings</h3>
                        </legend>
                        <div class="inputContainer inputContainer-withDescription">
                            <input is="emby-input" type="text" id="Host" required label="Host:" />
                            <div class="fieldDescription">This is the URL leading to where Shoko is running. You can input a full url, or just the dns name/ip.</div>
                        </div>
                        <div class="inputContainer inputContainer-withDescription">
                            <input is="emby-input" type="text" id="Username" required label="Username:" />
                            <div class="fieldDescription">The user should be an administrator in Shoko, preferably without any filtering applied.</div>
                        </div>
                        <div id="ConnectionSetContainer">
                            <div class="inputContainer inputContainer-withDescription">
                                <input is="emby-input" type="text" id="Password" label="Password:" />
                                <div class="fieldDescription">The password for account. It can be empty.</div>
                            </div>
                            <button is="emby-button" type="submit" class="raised button-submit block emby-button">
                                <span>Connect</span>
                            </button>
                            <div class="fieldDescription">Establish a connection to Shoko Server using the provided credentials.</div>
                        </div>
                        <div id="ConnectionResetContainer" hidden>
                            <button is="emby-button" type="submit" name="reset-connection" class="raised block emby-button">
                                <span>Reset Connection</span>
                            </button>
                            <div class="fieldDescription">Reset the connection. Be sure to stop any tasks using this plugin before you press the button.</div>
                        </div>
                    </fieldset>
                    <fieldset id="MetadataSection" class="verticalSection verticalSection-extrabottompadding" hidden>
                        <legend>
                            <h3>Metadata Settings</h3>
                        </legend>
                        <div class="selectContainer selectContainer-withDescription">
                            <label class="selectLabel" for="TitleMainType">Main title source:</label>
                            <select is="emby-select" id="TitleMainType" name="TitleMainType" class="emby-select-withcolor emby-select">
                                <option value="Default">Let Shoko decide the title</option>
                                <option value="MetadataPreferred">Use the preferred library metadata language</option>
                                <option value="Origin">Use the language from country of origin</option>
                            </select>
                            <div class="fieldDescription selectFieldDescription">How to select the main title for each item. The plugin will fallback to the default title if no title can be found in the target language.</div>
                        </div>
                        <div class="selectContainer selectContainer-withDescription">
                            <label class="selectLabel" for="TitleAlternateType">Alternate title source:</label>
                            <select is="emby-select" id="TitleAlternateType" name="TitleAlternateType" class="emby-select-withcolor emby-select">
                                <option value="Default">Let Shoko decide the title</option>
                                <option value="MetadataPreferred">Use the preferred library metadata language</option>
                                <option value="Origin">Use the language from country of origin</option>
                                <option value="Ignore">Do not use alternate titles</option>
                            </select>
                            <div class="fieldDescription selectFieldDescription">How to select the alternate title for each item. The plugin will fallback to the default title if no title can be found in the target language.</div>
                        </div>
                        <div class="selectContainer selectContainer-withDescription">
                            <label class="selectLabel" for="DescriptionSource">Description source:</label>
                            <select is="emby-select" id="DescriptionSource" name="DescriptionSource" class="emby-select-withcolor emby-select">
                                <option value="Default">Use default source for selected Series/Season grouping</option>
                                <option value="OnlyAniDb">Only use AniDB</option>
                                <option value="PreferAniDb">Prefer AniDB if available, otherwise use TvDB/TMDB</option>
                                <option value="OnlyOther">Only use TvDB/TMDB</option>
                                <option value="PreferOther">Prefer TvDB/TMDB if available, otherwise use AniDB</option>
                            </select>
                            <div class="fieldDescription selectFieldDescription">How to select the description to use for each item.</div>
                        </div>
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="TitleAddForMultipleEpisodes" />
                                <span>Add all metadata for multi-episode entries.</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription">Will add the title and description for every episode in a multi-episode entry.</div>
                        </div>
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="CleanupAniDBDescriptions" />
                                <span>Cleanup AniDB descriptions</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription">Remove links and collapse multiple empty lines into one empty line</div>
                        </div>
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="MinimalAniDBDescriptions" />
                                <span>Minimalistic AniDB descriptions</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription">Remove any lines starting with '* ', '-- ',  '~ ', 'Note', 'Source', and/or 'Summery'</div>
                        </div>
                        <button is="emby-button" type="submit" name="settings" class="raised button-submit block emby-button">
                            <span>Save</span>
                        </button>
                    </fieldset>
                    <fieldset id="ProviderSection" class="verticalSection verticalSection-extrabottompadding" hidden>
                        <legend>
                            <h3>Plugin Compatibility Settings</h3>
                        </legend>
                        <div class="fieldDescription verticalSection-extrabottompadding">We can optionally set some ids for interoperability with other plugins.</div>
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="AddAniDBId" />
                                <span>Add AniDB IDs</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription">Enabling this will add the AniDB ID for all supported item types where an ID is available.</div>
                        </div>
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="AddTvDBId" />
                                <span>Add TvDB IDs</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription">Enabling this will add the TvDB ID for all supported item types where an ID is available.</div>
                        </div>
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="AddTMDBId" />
                                <span>Add TMDB IDs</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription">Enabling this will add the TMDB ID for all supported item types where an ID is available.</div>
                        </div>
                        <button is="emby-button" type="submit" name="settings" class="raised button-submit block emby-button">
                            <span>Save</span>
                        </button>
                    </fieldset>
                    <fieldset id="LibrarySection" class="verticalSection verticalSection-extrabottompadding" hidden>
                        <legend>
                            <h3>Library Settings</h3>
                        </legend>
                        <div class="fieldDescription verticalSection-extrabottompadding">If you wish to set the Series/Grouping setting below to "Don't group Series into Seasons", you must disable "Automatically merge series that are spread across multiple folders" in the settings for all Libraries that depend on Shokofin for their metadata.<br>On the other hand, if you want to have Series and Grouping be determined by Shoko, or TvDB/TMDB - you must enable the "Automatically merge series that are spread across multiple folders" setting for all Libraries that use Shokofin for their metadata.<br>See the settings under each individual Library here: <a href="#!/library.html">Library Settings</a></div>
                        <div class="selectContainer selectContainer-withDescription">
                            <label class="selectLabel" for="SeriesGrouping">Series/Season grouping:</label>
                            <select is="emby-select" id="SeriesGrouping" name="SeriesGrouping" class="emby-select-withcolor emby-select">
                                <option value="Default" selected>Do not group Series into Seasons</option>
                                <option value="MergeFriendly">Group series into Seasons using the TvDB/TMDB data stored in Shoko</option>
                                <option value="ShokoGroup">Group series into Seasons based on Shoko's Groups</option>
                            </select>
                            <div class="fieldDescription selectFieldDescription"><div>Determines how to group Series together and divide them into Seasons.</div><div><strong>Warning:</strong> Modifying this setting requires the deletion and re-creation of any libraries using this plugin.</div><details style="margin-top: 0.5em"><summary style="margin-bottom: 0.25em">Why can't I just refresh all metadata?</summary>Currently, refreshing and replacing all metadata does not remove all the metadata stored by Jellyfin. Additionally, if two or more show's entries have been merged, they cannot then be unmerged. Recreation of the library is the only way to ensure that you do not have mixed metadata in your libraries.</details><details style="margin-top: 0.5em"><summary style="margin-bottom: 0.25em">What data is kept when recreating the libraries?</summary>The user data for each file is still kept after deleting a library. User data includes any ratings, play history, watch status and the last selected audio/subtitle track for a file.</details></div>
                        </div>
                        <div class="selectContainer selectContainer-withDescription">
                            <label class="selectLabel" for="BoxSetGrouping">Box-set/Movie grouping:</label>
                            <select is="emby-select" id="BoxSetGrouping" name="BoxSetGrouping" class="emby-select-withcolor emby-select">
                                <option value="Default" selected>Do not create Box-sets for Movies</option>
                                <option value="ShokoSeries">Create Box-sets based upon Shoko's Series entries</option>
                                <option value="ShokoGroup">Create Box-sets based upon Shoko's Groups and Series entries</option>
                            </select>
                            <div class="fieldDescription">Determines how to group Movies together into Box-sets.</div>
                        </div>
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="FilterOnLibraryTypes" />
                                <span>Enable library separation</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription">This setting can be used to have one shared root folder on your disk for two libraries in Shoko — one library for movies and one for shows. Enabling this will cause the plugin to actively filter out movies from the show library and everything but movies from the movies library. Also, if you've selected to use Shoko's Group feature to create Series/Seasons then it will also exclude the Movies from within the series — i.e. the "season" for the movie won't appear  — even if they share a group in Shoko.</div>
                        </div>
                        <div class="selectContainer selectContainer-withDescription">
                            <label class="selectLabel" for="SpecialsPlacement">Specials placement within seasons:</label>
                            <select is="emby-select" id="SpecialsPlacement" name="SpecialsPlacement" class="emby-select-withcolor emby-select">
                                <option value="AfterSeason">Always place Specials after the normal Episodes (Default)</option>
                                <option value="InBetweenSeasonByAirDate">Use release dates to place Specials</option>
                                <option value="InBetweenSeasonByOtherData">Loosely use the TvDB/TMDB data available in Shoko to place Specials</option>
                                <option value="InBetweenSeasonMixed">Either loosely use the TvDB/TMDB data available in Shoko or fallback to using release dates to place Specials</option>
                                <option value="Excluded">Exclude Specials from the Seasons</option>
                            </select>
                            <div class="fieldDescription selectFieldDescription">Determines how Specials are placed within Seasons. <strong>Warning:</strong> Modifying this setting requires a recreation (read as; delete existing then create a new) of any libraries using this plugin — otherwise you <strong>will</strong> have mixed metadata.</div>
                        </div>
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="MarkSpecialsWhenGrouped" />
                                <span>Mark specials</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription">Add a number to the title of each Special episode</div>
                        </div>
                        <button is="emby-button" type="submit" name="settings" class="raised button-submit block emby-button">
                            <span>Save</span>
                        </button>
                    </fieldset>
                    <fieldset id="UserSection" class="verticalSection verticalSection-extrabottompadding" hidden>
                        <legend>
                            <h3>User Settings</h3>
                        </legend>
                        <div class="selectContainer selectContainer-withDescription">
                            <label class="selectLabel" for="UserSelector">Configure settings for:</label>
                            <select is="emby-select" id="UserSelector" name="UserSelector" value="" class="emby-select-withcolor emby-select">
                                <option value="">Click here to select a user</option>
                            </select>
                            <div class="fieldDescription selectFieldDescription">Select a user to add, modify or delete the user settings for.</div>
                        </div>
                        <div id="UserSettingsContainer" hidden>
                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input is="emby-checkbox" type="checkbox" id="UserEnableSynchronization" />
                                    <span>Enable synchronization features</span>
                                </label>
                                <div class="fieldDescription checkboxFieldDescription">Enabling this setting is mandatory to enable the sync features below. Select the sync feature you would like to use by enabling the checkbox.</div>
                            </div>
                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input is="emby-checkbox" type="checkbox" id="SyncUserDataOnImport" />
                                    <span>Sync watch-state on import or refresh</span>
                                </label>
                                <div class="fieldDescription checkboxFieldDescription">Enabling this setting will import the watch-state for items from Shoko on import or refresh.</div>
                            </div>
                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input is="emby-checkbox" type="checkbox" id="SyncUserDataAfterPlayback" />
                                    <span>Sync watch-state after playback</span>
                                </label>
                                <div class="fieldDescription checkboxFieldDescription">Enabling this setting will sync-back the watch-state to Shoko after playback has ended.</div>
                            </div>
                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input is="emby-checkbox" type="checkbox" id="SyncUserDataUnderPlayback" />
                                    <span>Sync watch-state events during playback</span>
                                </label>
                                <div class="fieldDescription checkboxFieldDescription">Enabling this setting will sync-back the watch-state to Shoko on every play/pause/resume/stop event during playback.</div>
                            </div>
                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input is="emby-checkbox" type="checkbox" id="SyncUserDataUnderPlaybackLive" />
                                    <span>Sync watch-state live during playback</span>
                                </label>
                                <div class="fieldDescription checkboxFieldDescription">Enabling this setting will sync-back the watch-state to Shoko live during playback.</div>
                            </div>
                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input is="emby-checkbox" type="checkbox" id="SyncRestrictedVideos" />
                                    <span>Sync watch-state for restricted videos</span>
                                </label>
                                <div class="fieldDescription checkboxFieldDescription">Enabling this setting will sync-back the watch-state to Shoko for restricted videos (H).</div>
                            </div>
                            <div class="inputContainer inputContainer-withDescription">
                                <input is="emby-input" type="text" id="UserUsername" label="Username:" />
                                <div class="fieldDescription">The username of the account to synchronize with the currently selected user.</div>
                            </div>
                            <div id="UserPasswordContainer" class="inputContainer inputContainer-withDescription">
                                <input is="emby-input" type="text" id="UserPassword" label="Password:" />
                                <div class="fieldDescription">The password for account. It can be empty.</div>
                            </div>
                            <div id="UserDeleteContainer" class="inputContainer inputContainer-withDescription" hidden>
                                <button is="emby-button" type="submit" name="unlink-user" class="raised button-delete block emby-button">
                                    <span>Delete</span>
                                </button>
                                <div class="fieldDescription">This will delete any saved settings for the user.</div>
                            </div>
                            <button is="emby-button" type="submit" name="user-settings" class="raised button-submit block emby-button">
                                <span>Save</span>
                            </button>
                        </div>
                    </fieldset>
                    <fieldset id="TagSection" class="verticalSection verticalSection-extrabottompadding" hidden>
                        <legend>
                            <h3>Tag Settings</h3>
                        </legend>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="HideUnverifiedTags" />
                                <span>Hide unverified tags.</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="HideArtStyleTags" />
                                <span>Hide art style related tags</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="HideMiscTags" />
                                <span>Hide misc info tags that may be useful</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="HidePlotTags" />
                                <span>Hide potentially plot-spoiling tags</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="HideAniDbTags" />
                                <span>Hide any miscellaneous tags</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="HideSettingTags" />
                                <span>Hide any tags related to the setting — a time or place in which the story occurs.</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="HideProgrammingTags" />
                                <span>Hide any tags that involve how or where it aired, or any awards it got</span>
                            </label>
                        </div>
                        <button is="emby-button" type="submit" name="settings" class="raised button-submit block emby-button">
                            <span>Save</span>
                        </button>
                    </fieldset>
                    <fieldset id="AdvancedSection" class="verticalSection verticalSection-extrabottompadding" hidden>
                        <legend>
                            <h3>Advanced Settings</h3>
                        </legend>
                        <div class="inputContainer inputContainer-withDescription">
                            <input is="emby-input" type="text" id="PublicHost" label="Public Shoko host URL:" />
                            <div class="fieldDescription">This is the public URL leading to where Shoko is running. It is used to redirect to Shoko if you click on a Shoko ID in the UI if Shoko and/or Jellyfin is running within a container. It should include both the protocol and the IP/DNS name.</div>
                        </div>
                        <div class="inputContainer inputContainer-withDescription">
                            <input is="emby-input" type="text" id="IgnoredFileExtensions" label="Ignored file extensions:" />
                            <div class="fieldDescription">A space separated list of file extensions which will be ignored during the library scan.</div>
                        </div>
                        <div class="inputContainer inputContainer-withDescription">
                            <input is="emby-input" type="text" id="IgnoredFolders" label="Ignored folder names:" />
                            <div class="fieldDescription">A comma separated list of folder names which will be ignored during the library scan.</div>
                        </div>
                        <button is="emby-button" type="submit" name="settings" class="raised button-submit block emby-button">
                            <span>Save</span>
                        </button>
                    </fieldset>
                    <fieldset id="ExperimentalSection" class="verticalSection verticalSection-extrabottompadding" hidden>
                        <legend>
                            <h3>Experimental Settings</h3>
                        </legend>
                        <div class="fieldDescription verticalSection-extrabottompadding">Any features/settings in this section is still considered to be in an experimental state. <strong></strong>You can enable them, but at the risk if them messing up your library.</strong></div>
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="EXPERIMENTAL_AutoMergeVersions" />
                                <span>Automatically merge multiple versions</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription"><div>Automatically merge multiple versions of the same item together after a library scan. Only applies to items with a Shoko ID set.</div></div>
                        </div>
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="EXPERIMENTAL_SplitThenMergeMovies" />
                                <span>Always split existing versions of movies before merging multiple versions</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription"><div>Always split existing merged items before starting the merge.</div><details style="margin-top: 0.5em"><summary style="margin-bottom: 0.25em">What is this setting for?</summary>Enabling this setting will probably make the plugin do a lot of unneeded work on 99.5% of all movies, but will help for the last 0.5% that actually need it. An example is ensuring multiple parts of a movie series are not merged because they contain the same shok series id.</details></div>
                        </div>
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="EXPERIMENTAL_SplitThenMergeEpisodes" />
                                <span>Always split existing versions of episodes before merging multiple versions</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription"><div>Always split existing merged items before starting the merge.</div><details style="margin-top: 0.5em"><summary style="margin-bottom: 0.25em">What is this setting for?</summary>Enabling this setting will probably make the plugin do a lot of unneeded work on 99.5% of all movies, but will help for the last 0.5% that actually need it.</details></div>
                        </div>
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="EXPERIMENTAL_MergeSeasons" />
                                <span>Automatically merge cour seasons</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription"><div>Coming soon&trade; to a media library near you.</div></div>
                        </div>
                        <button is="emby-button" type="submit" name="settings" class="raised button-submit block emby-button">
                            <span>Save</span>
                        </button>
                    </fieldset>
                </div>
            </form>
        </div>
    </div>
</div>
